
URL=https://api.getastra.com/webhooks/integrations/ci-cd
ASTRA_SCAN_TYPE="${ASTRA_SCAN_TYPE:-lightning}"
status_code=$(curl -s -o response.txt -w "%{http_code}" --user-agent "Astra Pentest Trigger Script/1.0" --header "Content-Type: application/json" --request POST --data "{\"accessToken\":\"$ASTRA_ACCESS_TOKEN\",\"projectId\":\"$ASTRA_PROJECT_ID\", \"mode\":\"$ASTRA_AUDIT_MODE\", \"automatedScanType\":\"$ASTRA_SCAN_TYPE\"}" $URL)
if [[ "$status_code" == "200" ]] ; then
  echo "âœ… Astra pentest was successfully started."
  cat response.txt
elif [[ "$status_code" == "422" ]] ; then
  echo "ðŸŸ¡ Cannot start an audit, because an audit might be underway."
  cat response.txt
else
  echo "â›” Failed to start pentest."
  exit 1
fi
